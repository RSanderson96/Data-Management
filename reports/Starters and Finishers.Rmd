---
title: "Starters and Finishers"
author: "Rachael Sanderson"
date: "6 November 2019"
output:
  word_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir= normalizePath('..'))
library(ProjectTemplate)

```

```{r load_project, include = FALSE}
load.project()

```

# **Who is completing the course?**

##*The Intended Analysis*
This initial analysis will reflect on the decline of participants within the course, to consider which steps have the steepest decline. With this analysis, ideally a further understanding will be gained about which stages of teaching attract the most participents, and so which elements need to be improved to maintain student participation and so overall cohort attainment. 

##*The Applied Datasets*
The dataset used was the recorded "Step Activity" for each run of the course. For consistancy of the temporally based analysis, this was undertaken for runs 3-7 of the course, as these have identical step progressions through and so allow a more direct comparison. 

##*Data Preparation*
The following function was applied to produce a dataset for analysis. It was applied to produce each dataframe needed within the report, with minor changes to extract the appropriate data.

*Function: Making a data frame of starters*
```{R Function}
QuantitiesStarting.function = function(x){ #x = file selected to analyse
  StepActivity = x
  Steps=c((StepActivity$week_number)+((StepActivity$step_number)/100)) #acknowledging data complication (3.1 matches 3.10)
  StepActivity = cbind(StepActivity, Steps) #editing the data with the new column
  S= unique(StepActivity$Steps, incomparables = FALSE) #list the unique steps
  L =length(S) #How many steps are there?
  
#making the vector of quantities for each step
  
  total_values = vector() #making the vector
  for(i in 1:L){ #for loop: L = how many steps will be assessed/length of vector
    Step= StepActivity %>% filter(Steps==S[i]) #filter: group the rows for a single step
    Quant = nrow(Step) #how many rows were collected for that step?
    total_values[i]= Quant} #compile a vector of how many people started each step

#making the dataframe to be able to chart: Step against how many participants.
  
DFActivity = data.frame(Step = S, Total = total_values)
  
   return(DFActivity)} #return: the final dataframe for further analysis
   
```
This function then counts how many people started each step, to produce a data frame that can then be evaluated. It can further be manipulated to identify the total finishers, or to divide the participants weekly, as will be demonstrated further.  

##*Analysis*

###*Part One: How many are starting at each step?*
The first analysis was to record how many people are recorded as starting at each step, to reflect on how this declines. This was considered for each course, to consider if the trends were comparable for each run. With an awareness that the number of enrolments varies each year, there was a realisation that this data needs to be standardised to acknowledge this. Therefore, the data was represented as a proportion. Within this process, the code as above was repeated, with the y axis instead being the Y value / number of course starters.

The two can be modelled as below, with exact figures (left) and proportions (right):

```{R Starters}

Plot = ggplot (data =CourseS3,aes (x = X, y = Total))
CourseS3Graph =Plot +geom_point (aes (x= Step, y = CourseS3$Total, colour = "Course Run 3"))
CourseS4Graph = CourseS3Graph + geom_point (aes(x = Step, y = CourseS4$Total, colour = "Course Run 4"))
CourseS5Graph = CourseS4Graph +geom_point (aes (x= Step, y = CourseS5$Total, colour = "Course Run 5"))
CourseS6Graph = CourseS5Graph + geom_point (aes(x = Step, y = CourseS6$Total, colour = "Course Run 6"))
CourseS7Graph = CourseS6Graph + geom_point (aes(x = Step, y = CourseS7$Total, colour = "Course Run 7"))

#Alternatively, a proportion graph can be formed as below;

StartProp = ggplot (data = CourseS3,aes (x = X, y = Total))
CourseSP3Graph =StartProp +geom_point (aes (x= Step, y = CourseS3$Total/(Cohort_Summaries$Entries[3]), colour = "Course Run 3"))
CourseSP4Graph = CourseSP3Graph + geom_point (aes(x = Step, y = CourseS4$Total/(Cohort_Summaries$Entries[4]), colour = "Course Run 4")) #.....

```

The two can be modelled as below, with exact figures (left) and proportions (right):

```{R Proportion, include = FALSE}
CourseSP5Graph = CourseSP4Graph +geom_point (aes (x= Step, y = CourseS5$Total/(Cohort_Summaries$Entries[5]), colour = "Course Run 5"))
CourseSP6Graph = CourseSP5Graph + geom_point (aes(x = Step, y = CourseS6$Total/(Cohort_Summaries$Entries[6]), colour = "Course Run 6"))
CourseSP7Graph = CourseSP6Graph + geom_point (aes(x = Step, y = CourseS7$Total/(Cohort_Summaries$Entries[7]), colour = "Course Run 7"))

```

```{R Starter_Comparison}
grid.arrange(CourseS7Graph, CourseSP7Graph)

```

When comparing these graphs, the trends show limited differences. The trends show a gradual decline of starters at each step. DISTRIBUTION OF DECLINE? HYPOTHESIS TEST? NEED TO NEATEN GRAPHS

###*Part Two: How many are finishing at each step?*

When reflecting on analysis that focused on the starters, it was realised that there is an additional column of 'last_completed_at'. The assumption was made that when this 'completed' column is empty, it refers to the people who *did not finish a step* and so would have not completed the course, despite starting that section. If a step has a lower number of finishers, it is potential responsible for a higher number of dropouts - something that the educational programme wants to reduce. 
The data frame of finishers was produced in the same way as for the starters, with the addition of a single line of code at the start:

```{R Remove_Empties}

StepActivity = cyber.security.7.step.activity
  Filter = StepActivity %>% filter(last_completed_at !="")
  StepActivity=data.frame(Filter)

```

This code removes the rows that are empty in the "last_completed_at" to produce a data sample that only contains the people that are recorded as finishing each stage. The following graph was hence produced:

```{R Finishers}

Finishers = ggplot (data =CourseF3,aes (x = X, y = Total))
#CourseF1Graph = Plot +geom_point (aes (x= Step, y = CourseF1$Total, colour = "Course Run 1"))
#CourseF2Graph = Course1Graph + geom_point (aes(x = Step, y = CourseF2$Total, colour = "Course Run 2"))
CourseF3Graph =Finishers +geom_point (aes (x= Step, y = CourseF3$Total, colour = "Course Run 3"))
CourseF4Graph = CourseF3Graph + geom_point (aes(x = Step, y = CourseF4$Total, colour = "Course Run 4"))
CourseF5Graph = CourseF4Graph +geom_point (aes (x= Step, y = CourseF5$Total, colour = "Course Run 5"))
CourseF6Graph = CourseF5Graph + geom_point (aes(x = Step, y = CourseF6$Total, colour = "Course Run 6"))
CourseF7Graph = CourseF6Graph + geom_point (aes(x = Step, y = CourseF7$Total, colour = "Course Run 7"))

CourseF7Graph

```
Once again, it is acknowledged that the exact number of starters is a poor statistic to use for comparison of decline, as certain courses may have started with less entrants. Therefore, the Y axis was adapted to represent the number of finishers as a proportion of the number of starters;

```{R Finishers_proportion}
FinishProp = ggplot (data = CourseF3,aes (x = Step, y = Proportion_Finishers))
CourseFP3Graph = FinishProp + geom_point (aes (x= Step, y = CourseF3$Total/CourseS3$Total, colour = "Course Run 3"))

```
The final graph produced can be seen below;

```{R Finishers_Proportion_Graph, echo = FALSE}
FinishProp = ggplot (data = CourseF3,aes (x = Step, y = Proportion_Finishers))
#CourseFP1Graph = Plot +geom_point (aes (x= Step, y = Course1$Total, colour = "Course Run 1"))
#CourseFP2Graph = Course1Graph + geom_point (aes(x = Step, y = Course2$Total, colour = "Course Run 2"))
CourseFP3Graph = FinishProp + geom_point (aes (x= Step, y = CourseF3$Total/CourseS3$Total, colour = "Course Run 3"))
CourseFP4Graph = CourseFP3Graph + geom_point (aes(x = Step, y = CourseF4$Total/CourseS4$Total, colour = "Course Run 4"))
CourseFP5Graph = CourseFP4Graph +geom_point (aes (x= Step, y = CourseF5$Total/CourseS5$Total, colour = "Course Run 5"))
CourseFP6Graph = CourseFP5Graph + geom_point (aes(x = Step, y = CourseF6$Total/CourseS6$Total, colour = "Course Run 6"))
CourseFP7Graph = CourseFP6Graph + geom_point (aes(x = Step, y = CourseF7$Total/CourseS7$Total, colour = "Course Run 7"))

CourseFP7Graph
```

The graph shows limited correlation for each week, with each grouping being fairly clustered. There does not seem to be a particular *step* with a higher proportion of non-finishers throughout every run of the course, although noticably the cluster for stage 1 has a more linear trend than stages 2 and 3, implying that more people tend to drop out of the course as they are introduced to the content in the earlier stages, with the cohort settling as they are embedded in the course. In reflecting on the difference in the chart when the proportion of finishers is considered, the analysis led to the consideration of both starters and finishers.

###*Part Three: Contrasting Starters and Finishers*
The analysis focused on the difference between the two columns, and so began with the following data frame;

```{R Difference_DF}
DifferenceDF = data.frame(Step = CourseS3$Step, 
                          Difference3 = (CourseS3$Total-CourseF3$Total),
                          Difference4 = (CourseS4$Total-CourseF4$Total),
                          Difference5 = (CourseS5$Total-CourseF5$Total),
                          Difference6 = (CourseS6$Total-CourseF6$Total),
                          Difference7 = (CourseS7$Total-CourseF7$Total))
```

To plot the following graph;

```{R Difference_Graph}

D= ggplot (data=DifferenceDF, aes (x=Step, y=Difference))
D3 = D + geom_point(aes(x=Step, y= Difference3, colour = "Course Run3"))
D4 = D3 + geom_point(aes(x=Step, y= Difference4, colour = "Course Run4"))
D5 = D4 + geom_point(aes(x=Step, y= Difference5, colour = "Course Run5"))
D6 = D5 + geom_point(aes(x=Step, y= Difference6, colour = "Course Run6"))
D7 = D6 + geom_point(aes(x=Step, y= Difference7, colour = "Course Run7"))

D7

```

To adjust the graph, the difference between the two was calculated as a % of the number of starters:

```{R Diff_Percentage, echo = FALSE}
DifferencePercentDF = data.frame(Step = CourseS3$Step, 
                          DifferenceP3 = (((CourseS3$Total-CourseF3$Total)/CourseS3$Total)*100),
                          DifferenceP4 = (((CourseS4$Total-CourseF4$Total)/CourseS4$Total)*100),
                          DifferenceP5 = (((CourseS5$Total-CourseF5$Total)/CourseS5$Total)*100),
                          DifferenceP6 = (((CourseS6$Total-CourseF6$Total)/CourseS6$Total)*100),
                          DifferenceP7 = (((CourseS7$Total-CourseF7$Total)/CourseS7$Total)*100))

D= ggplot (data=DifferencePercentDF, aes (x=Step, y=Difference))
DP3 = D + geom_point(aes(x=Step, y= DifferenceP3, colour = "Course Run3"))
DP4 = DP3 + geom_point(aes(x=Step, y= DifferenceP4, colour = "Course Run4"))
DP5 = DP4 + geom_point(aes(x=Step, y= DifferenceP5, colour = "Course Run5"))
DP6 = DP5 + geom_point(aes(x=Step, y= DifferenceP6, colour = "Course Run6"))
DP7 = DP6 + geom_point(aes(x=Step, y= DifferenceP7, colour = "Course Run7"))

DiffPercent = DP7

DiffPercent
```

The graph of the percentages reflects a similar scatter to the number of finishers, however as a visualisation it is more effective. The difference calculated is the number of people that do not finish a step: this is the quantity that the educational provider wishes to reduce. However, in this graph the higher values are the ones that demand attention as the steps with the largest proportion of students dropping out. Therefore, as a final model to reflect on the proportion of students that do not complete each step, it is the most useful. 

###*Discrepencies: What does it mean to "Finish"?*

Returning to the finishers graph (see below), an anomoly was revealed, as certain steps noticably have less finishers than a step after it, implying that 'not completing' a step may not mean completing the course; this was investigated further.

```{R Show_Graph, echo = FALSE}
CourseF7Graph
```




